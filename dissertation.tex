\documentclass[12pt, oneside, a4paper, final]{memoir}

\setlrmarginsandblock{2cm}{2cm}{*}
\setulmarginsandblock{2cm}{2cm}{*}
\checkandfixthelayout
\input{dissertation-info}
\input{preamble}
\usepackage{etoolbox}
\input{pageformat}

\usepackage{letltxmacro}

\LetLtxMacro\Oldfootnote\footnote

\newcommand{\EnableFootNotes}{%
  \LetLtxMacro\footnote\Oldfootnote%
}

\newcommand{\DisableFootNotes}{%
  \renewcommand{\footnote}[2][]{\relax}
}



\makepagestyle{myruled}
\makeheadrule{myruled}{\textwidth}{\normalrulethickness}
\makeevenhead{myruled}{\bfseries\rightmark}{}{\hspace{1cm}\bfseries\thepage}
\makeoddhead{myruled}{\bfseries\rightmark}{}{\hspace{1cm}\bfseries\thepage}
\makefootrule{myruled}{\textwidth}{0pt}{0pt} % suppress bottom rule
\makeevenfoot{myruled}{}{}{}
\makeoddfoot{myruled}{}{}{}

% Ensure section titles are marked for headers
\makeatletter
\renewcommand{\sectionmark}[1]{\markright{\thesection\quad #1}}
\makeatother
\makeatletter
\renewcommand{\chaptermark}[1]{\markright{\thechapter\quad #1}}
\makeatother


\makechapterstyle{custom}{%
  \chapterstyle{default}
  \renewcommand*{\chapnamefont}{%
    \normalfont\normalsize\raggedright}
  \renewcommand*{\chaptitlefont}{%
    \normalfont\Large\bfseries\raggedright}
  \renewcommand*{\chapternamenum}{}
  \setlength{\chapindent}{0in}
  \setlength\midchapskip{0.5ex}\renewcommand*{\afterchapternum}{}
  \renewcommand*{\printchapternum}{\space\chapnamefont\bfseries\thechapter}
	\setlength{\beforechapskip}{-2\baselineskip}       	\setlength{\afterchapskip}{1.5ex}
  \renewcommand*{\printchaptertitle}[1]{
      \hrulefill\ \thepage\vskip\midchapskip
      \raggedleft \chaptitlefont ##1\par\nobreak}
}

\aliaspagestyle{chapter}{empty}
\begin{document}
%TC:ignore

\frontmatter
\include{Cover Page/coverpage}
\setlength{\beforechapskip}{10pt}
\pdfbookmark[1]{Declaration}{Declaration of Originality}
\input{Declaration/declaration}
\pdfbookmark[1]{Proforma}{Proforma}
\input{Proforma/proforma}

\chapterstyle{custom}


\titlespacing*{\section}{0pt}{1.5ex plus .2ex minus .1ex}{1ex}
\titlespacing*{\subsection}{0pt}{1.5ex plus .2ex minus .1ex}{1ex}
\titlespacing*{\subsubsection}{0pt}{1.5ex plus .2ex minus .1ex}{0.5ex}
\titlespacing*{\paragraph}{0pt}{1ex}{1em}

% Section
\titleformat{\section}
  {\normalfont\large\bfseries}
  {{\thesection}.}
  {1em}
  {#1}

% Subsection
\titleformat{\subsection}
  {\normalfont\normalsize\bfseries}
  {\thesubsection.}
  {1em}
  {#1}

% Subsubsection
\titleformat{\subsubsection}
  {\normalfont\normalsize\bfseries}
  {}
  {0pt}
  {#1}

% Paragraph
\titleformat{\paragraph}[runin]
  {\normalfont\bfseries}
  {}
  {0pt}
  {#1}
  [:]

\newpage

\pagestyle{myruled}
\setlrmarginsandblock{2cm}{2cm}{*}
\setulmarginsandblock{2cm}{1.2cm}{*}
\setheaderspaces{*}{4pt}{*}
\checkandfixthelayout[fixed]
%\DisableFootNotes

\setcounter{tocdepth}{2}
\pdfbookmark[1]{Contents}{Contents}
\tableofcontents*

%\DisableFootNotes
%TC:endignore
\setSpacing{0.95}
\mainmatter

\include{Introduction/introduction}
\include{Preparation/preparation}
\include{Implementation/implementation}
%\include{Implementation/implementation plan}
\include{Evaluation/evaluation}
\include{Conclusions/conclusions}


%TC:ignore
\setcounter{biburllcpenalty}{7000}
\setcounter{biburlucpenalty}{8000}
\DeclareFieldFormat{doi}{%
  \hfil\penalty90\hfilneg\space DOI\addcolon\addnbspace
  \ifhyperref
    {\href{https://doi.org/#1}{\nolinkurl{#1}}}
    {\nolinkurl{#1}}}
\printbibliography

\appendix
\include{Appendices/typejudgements}
\include{Appendices/formalsemantics}
\include{Appendices/slicing}
\include{Appendices/unboxingbugs}
\include{Appendices/extendedmatching}
\include{Appendices/results}
\include{Appendices/usability}
\include{Appendices/nondeterminismalternatives}
\include{Appendices/merges}

\backmatter
\include{Proposal/proposal}
%TC:endignore

\end{document}